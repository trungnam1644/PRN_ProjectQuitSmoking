<Window
    x:Class="WPFApp.Views.MembershipView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:conv="clr-namespace:WPFApp.Converters"
    xmlns:local="clr-namespace:WPFApp.Views"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    Title="Gói thành viên"
    Width="900"
    Height="650"
    FontFamily="Segoe UI"
    WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <conv:MoneyConverter x:Key="MoneyConverter" />
        <conv:DateToStringConverter x:Key="DateToStringConverter" />
        <conv:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <conv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <conv:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter" />
        <conv:InverseZeroToVisibilityConverter x:Key="InverseZeroToVisibilityConverter" />
        <conv:ZeroToVisibilityConverter x:Key="ZeroToVisibilityConverter" />

        <Style x:Key="PackageCardStyle" TargetType="Border">
            <Setter Property="Margin" Value="15" />
            <Setter Property="BorderBrush" Value="#E0E0E0" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Background" Value="White" />
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect
                        BlurRadius="10"
                        ShadowDepth="2"
                        Color="#10000000" />
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="PackageHeaderStyle" TargetType="Border">
            <Setter Property="Background" Value="#2ecc40" />
            <Setter Property="CornerRadius" Value="8,8,0,0" />
            <Setter Property="Padding" Value="15" />
            <Setter Property="Height" Value="60" />
        </Style>

        <Style
            x:Key="ActivePackageHeaderStyle"
            BasedOn="{StaticResource PackageHeaderStyle}"
            TargetType="Border">
            <Setter Property="Background" Value="#388E3C" />
        </Style>

        <Style
            x:Key="SelectButtonStyle"
            BasedOn="{StaticResource MaterialDesignRaisedButton}"
            TargetType="Button">
            <Setter Property="Background" Value="#388E3C" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="Margin" Value="15" />
            <Setter Property="Padding" Value="10,5" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="BorderThickness" Value="0" />
        </Style>

        <Style x:Key="FeatureItemStyle" TargetType="StackPanel">
            <Setter Property="Orientation" Value="Horizontal" />
            <Setter Property="Margin" Value="0,5" />
        </Style>

        <Style
            x:Key="PrimaryButton"
            BasedOn="{StaticResource MaterialDesignRaisedButton}"
            TargetType="Button">
            <Setter Property="Background" Value="#2ecc40" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="Margin" Value="10,0,0,0" />
            <Setter Property="Padding" Value="15,5" />
            <Setter Property="FontWeight" Value="SemiBold" />
        </Style>

        <Style
            x:Key="CancelButtonStyle"
            BasedOn="{StaticResource MaterialDesignOutlinedButton}"
            TargetType="Button">
            <Setter Property="Foreground" Value="#F44336" />
            <Setter Property="BorderBrush" Value="#F44336" />
            <Setter Property="Margin" Value="15" />
            <Setter Property="FontWeight" Value="SemiBold" />
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  Header Section  -->
        <materialDesign:Card
            Grid.Row="0"
            Padding="15"
            Background="#E3F2FD">
            <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                <materialDesign:PackIcon
                    Width="36"
                    Height="36"
                    Foreground="#2ecc40"
                    Kind="AccountStar" />
                <TextBlock
                    Margin="15,0,0,0"
                    FontSize="22"
                    FontWeight="Bold"
                    Foreground="#0D47A1"
                    Text="GÓI THÀNH VIÊN CAI THUỐC" />
            </StackPanel>
        </materialDesign:Card>

        <!--  Main Content  -->
        <ScrollViewer
            Grid.Row="1"
            Padding="0,15"
            VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!--  Current Active Package  -->
                <TextBlock
                    Margin="0,0,0,20"
                    HorizontalAlignment="Center"
                    FontSize="16"
                    FontWeight="Bold"
                    Foreground="#388E3C"
                    Text="GÓI ĐANG KÍCH HOẠT"
                    Visibility="{Binding CurrentPackage, Converter={StaticResource NullToVisibilityConverter}}" />

                <ContentControl Content="{Binding CurrentPackage}" Visibility="{Binding CurrentPackage, Converter={StaticResource NullToVisibilityConverter}}">
                    <ContentControl.ContentTemplate>
                        <DataTemplate>
                            <Border Style="{StaticResource PackageCardStyle}">
                                <Grid Width="280">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <!--  Package Header  -->
                                    <Border Style="{StaticResource ActivePackageHeaderStyle}">
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            FontSize="18"
                                            FontWeight="Bold"
                                            Foreground="White"
                                            Text="{Binding PackageName}" />
                                    </Border>
                                    <!--  Package Content  -->
                                    <StackPanel Grid.Row="1" Margin="15">
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="24"
                                            FontWeight="Bold"
                                            Foreground="#388E3C"
                                            Text="{Binding Price, Converter={StaticResource MoneyConverter}}" />
                                        <TextBlock
                                            Margin="0,15,0,10"
                                            HorizontalAlignment="Center"
                                            FontWeight="SemiBold"
                                            Text="{Binding DurationMonths, StringFormat={}{0} tháng}" />
                                        <StackPanel Margin="0,0,0,10">
                                            <TextBlock FontWeight="SemiBold" Text="Đặc điểm nổi bật:" />
                                            <ItemsControl ItemsSource="{Binding Features}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Style="{StaticResource FeatureItemStyle}">
                                                            <materialDesign:PackIcon
                                                                Width="16"
                                                                Height="16"
                                                                Margin="0,0,5,0"
                                                                Foreground="#4CAF50"
                                                                Kind="CheckCircle" />
                                                            <TextBlock Text="{Binding}" TextWrapping="Wrap" />
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                        <!--  Expiration Info  -->
                                        <Border
                                            Margin="0,10,0,0"
                                            Padding="10"
                                            Background="#FFF8E1"
                                            BorderBrush="#FFE0B2"
                                            BorderThickness="1"
                                            CornerRadius="5">
                                            <StackPanel>
                                                <TextBlock
                                                    FontWeight="SemiBold"
                                                    Foreground="#E65100"
                                                    Text="Ngày hết hạn:" />
                                                <TextBlock
                                                    Margin="0,5,0,0"
                                                    FontWeight="Bold"
                                                    Foreground="#E65100"
                                                    Text="{Binding EndDate, StringFormat={}{0:dd/MM/yyyy}}" />
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>
                                    <!--  Cancel Button  -->
                                    <Button
                                        Grid.Row="2"
                                        Command="{Binding DataContext.DeleteCurrentPackageCommand, RelativeSource={RelativeSource AncestorType=ContentControl}}"
                                        Content="HỦY GÓI"
                                        Style="{StaticResource CancelButtonStyle}" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ContentControl.ContentTemplate>
                </ContentControl>

                <!--  Available Packages  -->
                <TextBlock
                    Margin="0,30,0,20"
                    HorizontalAlignment="Center"
                    FontSize="16"
                    FontWeight="Bold"
                    Foreground="#2ecc40"
                    Text="CHỌN GÓI PHÙ HỢP VỚI BẠN" />

                <ItemsControl ItemsSource="{Binding MembershipPackages}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel HorizontalAlignment="Center" Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Style="{StaticResource PackageCardStyle}">
                                <Grid Width="280">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <!--  Package Header  -->
                                    <Border Style="{StaticResource PackageHeaderStyle}">
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            FontSize="18"
                                            FontWeight="Bold"
                                            Foreground="White"
                                            Text="{Binding PackageName}" />
                                    </Border>

                                    <!--  Package Content  -->
                                    <StackPanel Grid.Row="1" Margin="15">
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="24"
                                            FontWeight="Bold"
                                            Foreground="#2ecc40"
                                            Text="{Binding Price, Converter={StaticResource MoneyConverter}}" />

                                        <TextBlock
                                            Margin="0,15,0,10"
                                            HorizontalAlignment="Center"
                                            FontWeight="SemiBold"
                                            Text="{Binding DurationMonths, StringFormat={}{0} tháng}" />

                                        <StackPanel Margin="0,0,0,10">
                                            <TextBlock FontWeight="SemiBold" Text="Đặc điểm nổi bật:" />
                                            <ItemsControl ItemsSource="{Binding Features}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Style="{StaticResource FeatureItemStyle}">
                                                            <materialDesign:PackIcon
                                                                Width="16"
                                                                Height="16"
                                                                Margin="0,0,5,0"
                                                                Foreground="#4CAF50"
                                                                Kind="CheckCircle" />
                                                            <TextBlock Text="{Binding}" TextWrapping="Wrap" />
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>

                                        <TextBlock
                                            Margin="0,10,0,0"
                                            FontSize="12"
                                            Foreground="#666666"
                                            Text="{Binding Description}"
                                            TextWrapping="Wrap" />
                                    </StackPanel>

                                    <!--  Select Button  -->
                                    <Button
                                        Grid.Row="2"
                                        Command="{Binding DataContext.SelectPackageCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                        CommandParameter="{Binding}"
                                        Content="CHỌN GÓI"
                                        Style="{StaticResource SelectButtonStyle}" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!--  Selected Package Info  -->
                <materialDesign:Card Margin="20,30,20,10" Visibility="{Binding SelectedPackage, Converter={StaticResource NullToVisibilityConverter}}">
                    <StackPanel>
                        <TextBlock
                            Margin="0,0,0,10"
                            FontSize="16"
                            FontWeight="Bold"
                            Foreground="#2ecc40"
                            Text="GÓI BẠN ĐÃ CHỌN" />

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <StackPanel>
                                <TextBlock FontWeight="SemiBold" Text="Tên gói:" />
                                <TextBlock Margin="0,5,0,15" Text="{Binding SelectedPackage.PackageName}" />
                            </StackPanel>

                            <StackPanel Grid.Column="1">
                                <TextBlock FontWeight="SemiBold" Text="Giá:" />
                                <TextBlock Margin="0,5,0,15" Text="{Binding SelectedPackage.Price, Converter={StaticResource MoneyConverter}}" />
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock FontWeight="SemiBold" Text="Thời hạn:" />
                                <TextBlock Margin="0,5,0,15" Text="{Binding SelectedPackage.DurationMonths, StringFormat={}{0} tháng}" />
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </materialDesign:Card>
            </StackPanel>
        </ScrollViewer>

        <!--  Footer Buttons  -->
        <Border
            Grid.Row="2"
            Padding="10"
            BorderBrush="#E0E0E0"
            BorderThickness="0,1,0,0">
            <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                <Button
                    Click="GoBackButton_Click"
                    Content="QUAY LẠI"
                    Style="{StaticResource MaterialDesignOutlinedButton}" />

                <Button
                    Command="{Binding ConfirmPaymentCommand}"
                    Content="TIẾN HÀNH THANH TOÁN"
                    Style="{StaticResource PrimaryButton}"
                    Visibility="{Binding SelectedPackage, Converter={StaticResource NullToVisibilityConverter}}" />
            </StackPanel>
        </Border>
    </Grid>
</Window>