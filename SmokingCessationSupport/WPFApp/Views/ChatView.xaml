<Window
    x:Class="WPFApp.Views.ChatView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:conv="clr-namespace:WPFApp.Converters"
    xmlns:local="clr-namespace:WPFApp.ViewModels"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    Title="Chat với huấn luyện viên"
    Width="400"
    Height="600"
    WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <conv:MessageAlignmentMultiConverter x:Key="MessageAlignmentMultiConverter" />
        <conv:MessageBackgroundMultiConverter x:Key="MessageBackgroundMultiConverter" />
        <conv:MessageForegroundMultiConverter x:Key="MessageForegroundMultiConverter" />
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  Header  -->
        <Border
            Grid.Row="0"
            Padding="10"
            Background="#2ecc40">
            <StackPanel Orientation="Horizontal">
                <Button Click="BackButton_Click" Style="{StaticResource MaterialDesignIconButton}">
                    <materialDesign:PackIcon
                        Foreground="White"
                        Kind="ArrowLeft"
                        RenderTransformOrigin="-23.919,12.619" />
                </Button>

                <TextBlock
                    Margin="10,0,0,0"
                    FontSize="16"
                    FontWeight="Bold"
                    Foreground="White"
                    Text="{Binding _currentCoach.Name}" />
            </StackPanel>
        </Border>

        <!--  Khu vực tin nhắn  -->
        <ScrollViewer
            Grid.Row="1"
            Padding="10"
            Background="#FAFAFA">
            <ItemsControl ItemsSource="{Binding Messages}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="0,5">
                            <Grid.HorizontalAlignment>
                                <MultiBinding Converter="{StaticResource MessageAlignmentMultiConverter}">
                                    <Binding Path="SenderId" />
                                    <Binding Path="DataContext.CurrentUserId" RelativeSource="{RelativeSource AncestorType=Window}" />
                                </MultiBinding>
                            </Grid.HorizontalAlignment>
                            <StackPanel MaxWidth="300">
                                <Border Padding="10" CornerRadius="10">
                                    <Border.Background>
                                        <MultiBinding Converter="{StaticResource MessageBackgroundMultiConverter}">
                                            <Binding Path="SenderId" />
                                            <Binding Path="DataContext.CurrentUserId" RelativeSource="{RelativeSource AncestorType=Window}" />
                                        </MultiBinding>
                                    </Border.Background>
                                    <TextBlock TextWrapping="Wrap">
                                        <TextBlock.Foreground>
                                            <MultiBinding Converter="{StaticResource MessageForegroundMultiConverter}">
                                                <Binding Path="SenderId" />
                                                <Binding Path="DataContext.CurrentUserId" RelativeSource="{RelativeSource AncestorType=Window}" />
                                            </MultiBinding>
                                        </TextBlock.Foreground>
                                        <TextBlock.Text>
                                            <Binding Path="Message" />
                                        </TextBlock.Text>
                                    </TextBlock>
                                </Border>
                                <TextBlock
                                    Margin="5,2,0,0"
                                    HorizontalAlignment="Right"
                                    FontSize="11"
                                    Foreground="#666666"
                                    Text="{Binding SentAt, StringFormat=HH:mm}" />
                            </StackPanel>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!--  Khu vực nhập tin nhắn  -->
        <Border
            Grid.Row="2"
            BorderBrush="#DDDDDD"
            BorderThickness="0,1,0,0">
            <Grid Margin="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBox
                    VerticalContentAlignment="Center"
                    materialDesign:HintAssist.Hint="Nhập tin nhắn..."
                    Text="{Binding NewMessage, UpdateSourceTrigger=PropertyChanged}" />

                <Button
                    Grid.Column="1"
                    Margin="5,0,0,0"
                    Command="{Binding SendCommand}"
                    Style="{StaticResource MaterialDesignIconButton}">
                    <materialDesign:PackIcon Foreground="#2ecc40" Kind="Send" />
                </Button>
            </Grid>
        </Border>
    </Grid>
</Window>